<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ•™å¸«å‡ºé¡Œ Prompt æ¨¡æ¿ï½œAurora æ¥µå…‰ç‰ˆ</title>
  <style>
    :root{
      /* --- æ ¸å¿ƒé…è‰²ï¼šæ·±é‚ƒæ¥µå…‰ (Deep Aurora) --- */
      --bg: #0f172a;
      --text: #f1f5f9;
      --muted: #94a3b8;
      
      /* å“ç‰Œè‰²ï¼šæ™ºæ…§ç´« èˆ‡ éˆå‹•é’ */
      --brand: #8b5cf6;
      --brand-glow: rgba(139, 92, 246, 0.5);
      --accent: #2dd4bf;
      --accent-glow: rgba(45, 212, 191, 0.5);

      /* ç»ç’ƒæ“¬æ…‹åƒæ•¸ (Glassmorphism) */
      --glass-bg: rgba(30, 41, 59, 0.7);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-blur: 20px;
      --radius: 24px;
      
      /* é™°å½±å±¤æ¬¡ */
      --shadow-lg: 0 20px 50px -10px rgba(0, 0, 0, 0.5);
      --shadow-sm: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", system-ui, sans-serif;
      color: var(--text);
      background-color: var(--bg);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
      
      /* --- å‹•æ…‹æ¥µå…‰èƒŒæ™¯ --- */
      background-image: 
        radial-gradient(circle at 10% 10%, rgba(139, 92, 246, 0.15), transparent 40%),
        radial-gradient(circle at 90% 20%, rgba(45, 212, 191, 0.15), transparent 40%),
        radial-gradient(circle at 50% 90%, rgba(139, 92, 246, 0.1), transparent 50%);
      background-size: 200% 200%;
      animation: auroraMove 15s ease infinite alternate;
    }

    @keyframes auroraMove {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }

    .wrap {
      max-width: 1280px;
      margin: 0 auto;
      padding: 40px 24px 80px;
    }

    /* --- é ‚éƒ¨å°èˆª (Header) --- */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 32px;
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
    }

    /* é ‚éƒ¨æµå…‰æ•ˆæœ */
    header::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.5;
    }

    .title h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
      background: linear-gradient(135deg, #fff 0%, #cbd5e1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 0.5px;
    }
    .title .sub { font-size: 13px; color: var(--muted); margin-top: 4px; }

    .tag-pill {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 99px;
      background: rgba(45, 212, 191, 0.1);
      border: 1px solid rgba(45, 212, 191, 0.2);
      color: var(--accent);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* --- å…©æ¬„ä½ˆå±€ --- */
    .grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 24px;
    }
    @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }

    /* --- å¡ç‰‡å®¹å™¨ (Card) --- */
    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    
    .card .hd {
      padding: 20px 24px;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.02);
    }
    
    .card .bd { padding: 24px; flex: 1; display: flex; flex-direction: column; gap: 20px; }

    /* --- è¡¨å–®å…ƒä»¶ç¾åŒ– --- */
    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: var(--text);
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
      background: rgba(0, 0, 0, 0.5);
    }

    textarea {
      min-height: 450px;
      resize: vertical;
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      line-height: 1.7;
    }

    /* --- ç§‘ç›®é¸æ“‡ Tabs --- */
    .tabs { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
    .tab {
      padding: 8px 16px;
      border-radius: 99px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid transparent;
      font-size: 13px;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab:hover { background: rgba(255, 255, 255, 0.1); color: #fff; }
    .tab.active {
      background: rgba(139, 92, 246, 0.15);
      border-color: rgba(139, 92, 246, 0.3);
      color: #fff;
      font-weight: 600;
      box-shadow: 0 0 15px var(--brand-glow);
    }

    /* --- é¡Œçµ„å€å¡Š (Block) --- */
    .qblock {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .qblock:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.15);
    }

    /* é‡é»æ•´ç†ç‰¹æ®Šæ¨£å¼ (Aurora Green Glow) */
    .qblock[data-is-summary="true"] {
      border-color: rgba(45, 212, 191, 0.3);
      background: linear-gradient(90deg, rgba(45, 212, 191, 0.05) 0%, transparent 100%);
      box-shadow: 0 4px 20px rgba(45, 212, 191, 0.05);
    }

    .qhead { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .qtitle { font-weight: 700; font-size: 14px; display: flex; align-items: center; gap: 8px; }
    
    .qactions button {
      padding: 4px 8px;
      font-size: 12px;
      margin-left: 4px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* --- æŒ‰éˆ• (Buttons) --- */
    .btns { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    
    button {
      padding: 10px 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex; align-items: center; justify-content: center; gap: 6px;
    }
    
    button:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(-1px); }

    /* ä¸»è¦æŒ‰éˆ• (ç”Ÿæˆ) */
    button.primary {
      background: linear-gradient(135deg, var(--brand), #6366f1);
      border: none;
      color: #fff;
      box-shadow: 0 4px 15px var(--brand-glow);
    }
    button.primary:hover {
      box-shadow: 0 6px 20px var(--brand-glow);
      filter: brightness(1.1);
    }

    /* ç‰¹æ®ŠæŒ‰éˆ• (é‡é»æ•´ç†) */
    #btnAddSummary {
      border-color: rgba(45, 212, 191, 0.3);
      color: var(--accent);
    }
    #btnAddSummary:hover {
      background: rgba(45, 212, 191, 0.1);
    }

    /* --- ç¶²æ ¼è¼”åŠ© --- */
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .qgrid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 16px; }
    @media (max-width: 600px) { .row, .qgrid { grid-template-columns: 1fr; } }

    /* --- å…¶ä»– --- */
    .divider { height: 1px; background: rgba(255, 255, 255, 0.1); margin: 24px 0; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 8px; padding-left: 10px; border-left: 2px solid var(--accent); }

    .toast {
      position: fixed; left: 50%; bottom: 40px; transform: translateX(-50%);
      background: #0f172a; border: 1px solid var(--accent);
      color: var(--accent); padding: 12px 24px; border-radius: 99px;
      font-size: 14px; font-weight: 600;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      z-index: 100; display: none;
    }
  </style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="title">
      <h1>æ•™å¸«å‡ºé¡Œ Prompt æ¨¡æ¿ <span style="font-size:0.8em; opacity:0.8; font-weight:400;">Aurora Edition</span></h1>
      <div class="sub">âœ¨ è³‡æ·±æ•™å¸«é‚è¼¯ âœ• å­¸ç§‘ç´ é¤Šå°å‘ ï½œ åœ‹èªæˆèª ï½œ ç¤¾æœƒå¹´è¡¨ ï½œ ç§‘å­¸æ¢ç©¶</div>
    </div>
    <div class="tag-pill">Gemini 2.0 Optimized</div>
  </header>

  <div class="grid">
    <div class="card">
      <div class="hd">
        <b>âš™ï¸ åƒæ•¸è¨­å®šé¢æ¿</b>
        <span class="tag-pill" id="summaryBadge" style="background:rgba(255,255,255,0.05); color:var(--text); border-color:rgba(255,255,255,0.1)">ç§‘ç›®ï¼šåœ‹èª</span>
      </div>
      <div class="bd">
        <div class="tabs" id="subjectTabs">
          <div class="tab active" data-subject="åœ‹èª">åœ‹èª (å­—è©/æˆèª)</div>
          <div class="tab" data-subject="æ•¸å­¸">æ•¸å­¸ (é‚è¼¯/æ‡‰ç”¨)</div>
          <div class="tab" data-subject="ç¤¾æœƒ">ç¤¾æœƒ (æ•…äº‹/æ™‚åº)</div>
          <div class="tab" data-subject="è‡ªç„¶">è‡ªç„¶ (å¯¦é©—/è®Šå› )</div>
          <div class="tab" data-subject="è‹±æ–‡">è‹±æ–‡ (æ–‡æ³•/é–±è®€)</div>
        </div>

        <div class="row">
          <div>
            <label>å¹´ç´šå°è±¡</label>
            <select id="grade">
              <option>ä¸‰å¹´ç´š</option><option>å››å¹´ç´š</option><option>äº”å¹´ç´š</option><option selected>å…­å¹´ç´š</option>
              <option>åœ‹ä¸­ä¸ƒå¹´ç´š</option><option>åœ‹ä¸­å…«å¹´ç´š</option><option>åœ‹ä¸­ä¹å¹´ç´š</option>
            </select>
          </div>
          <div>
            <label>æ•´é«”é›£åº¦</label>
            <select id="overallDifficulty">
              <option value="ä¸­" selected>æ¨™æº–ï¼ˆä¸­ç­‰ï¼‰</option>
              <option value="æ˜“">åŸºç¤ï¼ˆç°¡å–®ï¼‰</option>
              <option value="é›£">é€²éšï¼ˆå›°é›£ï¼‰</option>
              <option value="æ··åˆé›£æ˜“åº¦">æ··åˆï¼ˆæ˜“3:ä¸­4:é›£3ï¼‰</option>
              <option value="ç´ é¤Šå°å‘">ç´ é¤Šå°å‘ï¼ˆæƒ…å¢ƒå¤š/é¡Œå¹¹é•·ï¼‰</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
           <div>
             <label>ç‰ˆæœ¬/ä¾†æº (é¸å¡«)</label>
             <input id="publisher" placeholder="ä¾‹ï¼šåº·è»’ / ç¿°æ— / å—ä¸€">
           </div>
           <div>
             <label>æ¸¬é©—/è¬›ç¾©ä¸»é¡Œ (é¸å¡«)</label>
             <input id="examTopic" placeholder="ä¾‹ï¼šæœŸæœ«è€ƒç¯„åœ / ç¬¬äºŒå–®å…ƒ">
           </div>
        </div>
        
        <div class="divider"></div>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
          <b style="font-size:14px; color:#fff;">ğŸ“¦ å…§å®¹å€å¡Šæ¸…å–®</b>
        </div>

        <div id="blocks"></div>

        <div class="btns">
          <button class="ghost" id="btnAdd">ï¼‹ æ–°å¢æ¸¬é©—é¡Œçµ„</button>
          <button class="ghost" id="btnAddSummary" id="btnAddSummary">ï¼‹ æ–°å¢é‡é»æ•´ç†</button>
        </div>
        
        <div class="btns" style="margin-top:20px;">
          <button class="ghost" id="btnLoadSample" style="width:100%; justify-content:center; border-style:dashed;">ğŸ“¥ ä¸€éµå¥—ç”¨ï¼šç¤¾æœƒç§‘ç¯„ä¾‹ (æ··ç”¨æ¨¡å¼)</button>
        </div>

        <div style="margin-top:auto; padding-top:24px;">
           <button class="primary" id="btnGenerate" style="width:100%; font-size:15px; padding:14px;">âœ¨ ç«‹å³ç”Ÿæˆ AI æŒ‡ä»¤ (Prompt)</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="hd">
        <b>ğŸ“ AI æŒ‡ä»¤è¼¸å‡ºå€</b>
        <span class="tag-pill" id="countBadge" style="background:rgba(255,255,255,0.05); color:var(--text); border-color:rgba(255,255,255,0.1)">ç¸½é¡Œæ•¸ï¼šâ€”</span>
      </div>
      <div class="bd">
        <textarea id="output" placeholder="ğŸ’¡ æ“ä½œæŒ‡å¼•ï¼š&#10;1. é¸æ“‡ä¸Šæ–¹ã€Œç§‘ç›®ã€ï¼Œç³»çµ±æœƒè‡ªå‹•åˆ‡æ›è©²ç§‘ç›®çš„å°ˆæ¥­é¡Œå‹ã€‚&#10;2. ä¾‹å¦‚ï¼šé¸ã€Œåœ‹èªã€æœƒå‡ºç¾æˆèªã€å­—éŸ³å­—å½¢ï¼›é¸ã€Œè‡ªç„¶ã€æœƒå‡ºç¾å¯¦é©—é¡Œã€‚&#10;3. é»æ“Šã€Œç”Ÿæˆ Promptã€ä¸¦è²¼çµ¦ AIã€‚&#10;&#10;---&#10;æœ¬ç‰ˆæ›´æ–° (v2.0)ï¼š&#10;âœ… åœ‹èªç§‘ï¼šå¼·åŒ–æˆèªã€ä¿®è¾­èˆ‡æ•™è‚²éƒ¨æ³¨éŸ³æ¨™æº–ã€‚&#10;âœ… æ•¸å­¸ç§‘ï¼šè¦æ±‚è©³åˆ—è¨ˆç®—éç¨‹èˆ‡å–®ä½æª¢æŸ¥ã€‚&#10;âœ… è‡ªç„¶ç§‘ï¼šåŠ å…¥å¯¦é©—è®Šå› æ§åˆ¶èˆ‡æ¢ç©¶é‚è¼¯ã€‚&#10;âœ… è‹±æ–‡ç§‘ï¼šæ–°å¢å…‹æ¼å­—èˆ‡ç¿»è­¯é¡Œå‹ã€‚"></textarea>
        
        <div class="btns">
          <button class="ghost" id="btnCopy" style="flex:1;">ğŸ“‹ ä¸€éµè¤‡è£½</button>
          <button class="ghost" id="btnReset" style="flex:1; color:#f87171; border-color:rgba(248,113,113,0.3);">ğŸ—‘ï¸ æ¸…ç©ºé‡è¨­</button>
        </div>
        
        <div class="hint">
          <b>è³‡æ·±æ•™å¸« Tipï¼š</b> 
          ç³»çµ±æœƒæ ¹æ“šæ‚¨é¸æ“‡çš„ç§‘ç›®ï¼Œè‡ªå‹•åœ¨ Prompt ä¸­æ¤å…¥ã€Œå­¸ç§‘å°ˆå±¬æŒ‡ä»¤ã€ï¼ˆä¾‹å¦‚ï¼šç¤¾æœƒç§‘çš„æ™‚åºã€åœ‹èªç§‘çš„æ³¨éŸ³æ¨™æº–ã€è‡ªç„¶ç§‘çš„å¯¦é©—é‚è¼¯ï¼‰ï¼Œç¢ºä¿ç”Ÿæˆçš„å…§å®¹ç¬¦åˆæ•™å­¸ç¾å ´å°ˆæ¥­éœ€æ±‚ã€‚
        </div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast">âœ… å·²è¤‡è£½æŒ‡ä»¤ï¼è«‹è²¼çµ¦ AI é–‹å§‹å‚™èª²</div>

<script>
  const $ = (id) => document.getElementById(id);
  let currentSubject = "åœ‹èª";

  /* --- ç§‘ç›®é¡Œå‹å®šç¾© (è³‡æ·±æ•™å¸«è³‡æ–™åº«) --- */
  const subjectTypes = {
    "åœ‹èª": ["é¸æ“‡é¡Œ", "å­—éŸ³å­—å½¢ (å«æ”¹éŒ¯)", "æˆèªé‹ç”¨", "æ”¹å¯«å¥å­/é€ å¥", "é–±è®€é¡Œçµ„", "é‡é»æ•´ç†"],
    "æ•¸å­¸": ["é¸æ“‡é¡Œ", "å¡«å……é¡Œ (è¨ˆç®—)", "æ‡‰ç”¨é¡Œ (ç´ é¤Šå°å‘)", "æ˜¯éé¡Œ", "é‡é»æ•´ç†"],
    "ç¤¾æœƒ": ["é¸æ“‡é¡Œ", "é…å°é¡Œ (å¹´ä»£/äººç‰©)", "å¡«å……é¡Œ", "ç°¡ç­”é¡Œ", "é–±è®€é¡Œçµ„ (å²æ–™åˆ†æ)", "é‡é»æ•´ç†"],
    "è‡ªç„¶": ["é¸æ“‡é¡Œ", "å¯¦é©—è®Šå› é¡Œ", "å¡«å……é¡Œ", "æ˜¯éé¡Œ", "é–±è®€é¡Œçµ„ (ç§‘å­¸æ–°çŸ¥)", "é‡é»æ•´ç†"],
    "è‹±æ–‡": ["é¸æ“‡é¡Œ (å–®å­—/æ–‡æ³•)", "å…‹æ¼å­— (Cloze)", "ä¸­ç¿»è‹±/è‹±ç¿»ä¸­", "é–±è®€æ¸¬é©—", "é…å°é¡Œ", "é‡é»æ•´ç†"]
  };

  /* --- åˆ‡æ›ç§‘ç›® --- */
  document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      currentSubject = tab.dataset.subject;
      $("summaryBadge").textContent = `ç§‘ç›®ï¼š${currentSubject}`;
      
      // åˆ‡æ›ç§‘ç›®æ™‚ï¼Œé‡æ–°æ•´ç†é¡Œå‹é¸å–® (è‹¥ä½¿ç”¨è€…æƒ³ä¿ç•™æ—¢æœ‰å€å¡Šå‰‡ä¸å‹•ï¼Œæ–°å€å¡Šæ‰ç”Ÿæ•ˆ)
      // é€™è£¡é¸æ“‡ç°¡å–®ç­–ç•¥ï¼šæç¤ºä½¿ç”¨è€…
      const t = $("toast");
      t.textContent = `å·²åˆ‡æ›ç‚ºï¼š${currentSubject} (æ–°å¢é¡Œç›®æ™‚å°‡é¡¯ç¤ºå°ˆå±¬é¡Œå‹)`;
      t.style.display = "block";
      setTimeout(()=>t.style.display="none", 2000);
    });
  });

  /* --- å»ºç«‹å€å¡Š (Block Factory) --- */
  function makeBlock(data = {}) {
    const div = document.createElement("div");
    const isSummary = data.type === "é‡é»æ•´ç†";
    
    div.className = "qblock";
    if(isSummary) div.setAttribute("data-is-summary", "true");
    
    // æ ¹æ“šç•¶å‰ç§‘ç›®ç”Ÿæˆé¸é …
    const typeList = subjectTypes[currentSubject] || subjectTypes["åœ‹èª"];
    let optionsHtml = "";
    
    typeList.forEach(t => {
      const selected = (data.type === t) ? "selected" : "";
      optionsHtml += `<option value="${t}" ${selected}>${t}</option>`;
    });

    // å¦‚æœç¾æœ‰çš„ block type ä¸åœ¨ç•¶å‰ç§‘ç›®æ¸…å–®ä¸­ (ä¾‹å¦‚åˆ‡æ›ç§‘ç›®å¾Œ)ï¼Œé‚„æ˜¯è¦ä¿ç•™é¡¯ç¤º
    if(data.type && !typeList.includes(data.type)) {
       optionsHtml += `<option value="${data.type}" selected>${data.type} (å…¶ä»–)</option>`;
    }

    div.innerHTML = `
      <div class="qhead">
        <div class="qtitle">
          ${isSummary ? 'ğŸ“š é‡é»æ•´ç†è¬›ç¾©' : 'âœï¸ æ¸¬é©—é¡Œçµ„'}
        </div>
        <div class="qactions">
          <button class="ghost" onclick="moveBlock(this, -1)">â†‘</button>
          <button class="ghost" onclick="moveBlock(this, 1)">â†“</button>
          <button class="ghost" onclick="removeBlock(this)" style="color:#f87171; border-color:rgba(248,113,113,0.3)">Ã—</button>
        </div>
      </div>

      <div class="qgrid">
        <div>
          <label>å–®å…ƒåç¨± / ç¯„åœ</label>
          <input data-k="unit" placeholder="${isSummary ? 'ä¾‹ï¼šä¿®è¾­ / å°ç£åœ°å½¢' : 'ä¾‹ï¼šåˆ†æ•¸ / ç¬¬ä¸€èª²'}" value="${data.unit||""}">
        </div>
        <div>
          <label>é¡Œå‹</label>
          <select data-k="type" onchange="updateBlockUI(this)">${optionsHtml}</select>
        </div>
      </div>

      <div class="dynamic-fields">
        <div class="row field-std" style="margin-top:16px;">
          <div>
            <label>é¡Œæ•¸</label>
            <input data-k="count" type="number" min="1" value="${data.count||5}">
          </div>
          <div>
            <label>é›£åº¦</label>
            <select data-k="difficulty">
              <option ${data.difficulty==="æ˜“"?"selected":""}>æ˜“</option>
              <option ${data.difficulty==="ä¸­"?"selected":""}>ä¸­</option>
              <option ${data.difficulty==="é›£"?"selected":""}>é›£</option>
              <option ${data.difficulty==="æ··åˆ"?"selected":""}>æ··åˆ</option>
            </select>
          </div>
        </div>

        <div class="row field-match" style="display:none; margin-top:16px;">
          <div><label>å·¦å´é¡Œç›®æ•¸</label><input data-k="matchCount" type="number" value="${data.matchCount||5}"></div>
          <div><label>å³å´é¸é …æ± </label><input data-k="matchPool" type="number" value="${data.matchPool||6}"></div>
        </div>

        <div class="row field-reading" style="display:none; margin-top:16px;">
          <div><label>æ–‡ç« å­—æ•¸</label><input data-k="readWords" type="number" value="${data.readWords||450}"></div>
          <div><label>æ¯çµ„é¡Œæ•¸</label><input data-k="readQps" type="number" value="${data.readQps||5}"></div>
        </div>

        <div class="field-summary" style="display:none; margin-top:16px; border-top:1px dashed rgba(255,255,255,0.1); padding-top:16px;">
          <div class="row">
            <div>
              <label>å…§å®¹æ·±åº¦</label>
              <select data-k="sumDepth">
                <option value="æ¨™æº–" ${data.sumDepth!=="è©³ç´°"?"selected":""}>æ¨™æº– (è€ƒå‰è¤‡ç¿’ç”¨)</option>
                <option value="è©³ç´°" ${data.sumDepth==="è©³ç´°"?"selected":""}>è©³ç´° (å«æ•…äº‹/å»¶ä¼¸æ•™å­¸)</option>
              </select>
            </div>
            <div>
              <label>æ¯”è¼ƒå‘ˆç¾æ–¹å¼</label>
              <select data-k="sumViz">
                <option value="è¡¨æ ¼">Markdown è¡¨æ ¼ (æ¨è–¦)</option>
                <option value="æµç¨‹åœ–">æ–‡å­—æµç¨‹åœ– (Aâ†’B)</option>
                <option value="æ¢åˆ—">éšå±¤å¼æ¢åˆ—</option>
              </select>
            </div>
          </div>
          <div class="hint" style="margin-top:12px;">
            âœ¨ <span id="summaryHintText">ç³»çµ±å°‡è‡ªå‹•ä¾æ“šç§‘ç›®ç‰¹æ€§ç”Ÿæˆæœ€ä½³åŒ–æ•´ç†çµæ§‹ã€‚</span>
          </div>
        </div>
      </div>
    `;

    setTimeout(() => updateBlockUI(div.querySelector('select[data-k="type"]')), 0);
    return div;
  }

  /* --- UI æ›´æ–°é‚è¼¯ --- */
  function updateBlockUI(selectInfo) {
    const block = selectInfo.closest('.qblock');
    const type = selectInfo.value;
    const isSummary = type === "é‡é»æ•´ç†";
    
    if(isSummary) block.setAttribute("data-is-summary", "true");
    else block.removeAttribute("data-is-summary");
    
    block.querySelector('.qtitle').textContent = isSummary ? 'ğŸ“š é‡é»æ•´ç† (AI æ™ºèƒ½ç”Ÿæˆ)' : 'âœï¸ æ¸¬é©—é¡Œçµ„';

    const fStd = block.querySelector('.field-std');
    const fMatch = block.querySelector('.field-match');
    const fRead = block.querySelector('.field-reading');
    const fSum = block.querySelector('.field-summary');

    fStd.style.display = "none";
    fMatch.style.display = "none";
    fRead.style.display = "none";
    fSum.style.display = "none";

    if (type.includes("é…å°")) fMatch.style.display = "grid";
    else if (type.includes("é–±è®€")) fRead.style.display = "grid";
    else if (type === "é‡é»æ•´ç†") fSum.style.display = "block";
    else fStd.style.display = "grid";
  }

  function addBlock(data) { $("blocks").appendChild(makeBlock(data)); }
  function removeBlock(btn) { btn.closest('.qblock').remove(); }
  function moveBlock(btn, dir) {
    const block = btn.closest('.qblock');
    if (dir === -1 && block.previousElementSibling) block.parentElement.insertBefore(block, block.previousElementSibling);
    if (dir === 1 && block.nextElementSibling) block.parentElement.insertBefore(block.nextElementSibling, block);
  }

  /* --- æ ¸å¿ƒï¼šPrompt ç”Ÿæˆ (è³‡æ·±æ•™å¸«é‚è¼¯å¼•æ“) --- */
  function generatePrompt() {
    const grade = $("grade").value;
    const subject = currentSubject;
    const diff = $("overallDifficulty").value;
    const publisher = $("publisher").value;
    const topic = $("examTopic").value;
    
    const blocks = Array.from(document.querySelectorAll('.qblock')).map(b => {
      const get = k => b.querySelector(`[data-k="${k}"]`)?.value;
      return {
        unit: get('unit') || "ï¼ˆæœªå¡«å¯«å–®å…ƒï¼‰",
        type: get('type'),
        count: get('count'),
        difficulty: get('difficulty'),
        matchCount: get('matchCount'),
        matchPool: get('matchPool'),
        readWords: get('readWords'),
        readQps: get('readQps'),
        sumDepth: get('sumDepth'),
        sumViz: get('sumViz')
      };
    });

    const quizBlocks = blocks.filter(b => b.type !== "é‡é»æ•´ç†");
    const sumBlocks = blocks.filter(b => b.type === "é‡é»æ•´ç†");

    let prompt = "";

    /* --- ç§‘ç›®å°ˆå±¬ System Prompt (æ³¨å…¥éˆé­‚) --- */
    let subjectInstruction = "";
    if (subject === "ç¤¾æœƒ") {
      subjectInstruction = `
- **ã€æ™‚åºèˆ‡æ•…äº‹ã€‘**ï¼šè‹¥æ¶‰åŠæ­·å²ï¼Œå¿…é ˆè£½ä½œã€Œå¤§äº‹å¹´è¡¨ã€é‡æ¸…æ™‚åºã€‚åœ¨æ ¸å¿ƒæ¦‚å¿µè§£èªªæ™‚ï¼Œè«‹è£œå……ç›¸é—œã€Œæ­·å²å°æ•…äº‹ã€æˆ–ã€Œå‚³èªªã€ä»¥å¢åŠ è¨˜æ†¶é»ã€‚
- **ã€åœ°åœ–èˆ‡ç©ºé–“ã€‘**ï¼šè‹¥æ¶‰åŠåœ°ç†ï¼Œè«‹ä»¥æ–‡å­—ç”Ÿå‹•æè¿°åœ°å½¢ç‰¹å¾µæˆ–åœ°åœ–ç›¸å°ä½ç½®ã€‚`;
    } else if (subject === "åœ‹èª") {
      subjectInstruction = `
- **ã€æ³¨éŸ³è¦ç¯„ã€‘**ï¼šç”Ÿé›£å­—è©å¿…é ˆæ¨™è¨»ã€Œæ•™è‚²éƒ¨æ¨™æº–æ³¨éŸ³ (Bopomofo)ã€ã€‚
- **ã€æˆèªèˆ‡ä¿®è¾­ã€‘**ï¼šè«‹ç‰¹åˆ¥è‘—é‡ã€Œæˆèªé‹ç”¨ã€èˆ‡ã€Œä¿®è¾­æŠ€å·§ã€çš„è§£æã€‚
- **ã€èªæ–‡ç´ é¤Šã€‘**ï¼šé¿å…æ­»èƒŒè§£é‡‹ï¼Œè«‹æä¾›ã€Œç”Ÿæ´»ä¾‹å¥ã€æˆ–ã€Œèªå¢ƒæ‡‰ç”¨ã€ã€‚`;
    } else if (subject === "æ•¸å­¸") {
      subjectInstruction = `
- **ã€è¨ˆç®—éç¨‹ã€‘**ï¼šè©³è§£å·å¿…é ˆåˆ—å‡ºã€ŒStep-by-step è¨ˆç®—éç¨‹ã€ï¼Œä¸èƒ½åªçµ¦ç­”æ¡ˆã€‚
- **ã€ç´ é¤Šæ‡‰ç”¨ã€‘**ï¼šæ‡‰ç”¨é¡Œè«‹è¨­è¨ˆè²¼è¿‘å°å­¸ç”Ÿç”Ÿæ´»çš„çœŸå¯¦æƒ…å¢ƒï¼ˆå¦‚è³¼ç‰©ã€æ—…éŠã€åˆ†é…ï¼‰ã€‚
- **ã€å–®ä½æª¢æŸ¥ã€‘**ï¼šè«‹åœ¨è©³è§£ä¸­ç‰¹åˆ¥æé†’ã€Œå–®ä½æ›ç®—ã€çš„æ˜“éŒ¯é»ã€‚`;
    } else if (subject === "è‡ªç„¶") {
      subjectInstruction = `
- **ã€å¯¦é©—æ¢ç©¶ã€‘**ï¼šè«‹å¼·èª¿ã€Œæ“ä½œè®Šå› ã€ã€ã€Œæ§åˆ¶è®Šå› ã€èˆ‡ã€Œæ‡‰è®Šè®Šå› ã€çš„åˆ†æã€‚
- **ã€ç§‘å­¸é‚è¼¯ã€‘**ï¼šè§£é‡‹ç¾è±¡æ™‚ï¼Œè«‹ä¾ç…§ã€Œè§€å¯Ÿ -> å‡è¨­ -> é©—è­‰ã€çš„é‚è¼¯ã€‚`;
    } else if (subject === "è‹±æ–‡") {
      subjectInstruction = `
- **ã€èªè¨€åˆ†ç´šã€‘**ï¼šè«‹ç¢ºä¿å–®å­—èˆ‡æ–‡æ³•é›£åº¦ç¬¦åˆå°ç£åœ‹ä¸­/å° ${grade} ç¨‹åº¦ (åƒè€ƒ CEFR A1-A2)ã€‚
- **ã€æ–‡æ³•è§£æã€‘**ï¼šè©³è§£è«‹æ¸…æ¥šè§£é‡‹æ–‡æ³•è¦å‰‡ï¼Œä¸¦æä¾›éŒ¯èª¤é¸é …çš„éŒ¯èª¤åŸå› ã€‚`;
    }

    /* --- Part A: é‡é»æ•´ç† --- */
    if (sumBlocks.length > 0) {
      const unitDetails = sumBlocks.map((b, i) => {
         return `å–®å…ƒ ${i+1}ï¼š${b.unit} (æ·±åº¦ï¼š${b.sumDepth} / è¦–è¦ºï¼š${b.sumViz})`;
      }).join("\n");

      prompt += `
# ç³»çµ±è¨­å®š (Part A: é‡é»æ•´ç†è¬›ç¾©)
ä½ ç¾åœ¨çš„èº«åˆ†æ˜¯ä¸€ä½æ·±è€• ${subject} æ•™å­¸çš„è³‡æ·±æ•™å¸«ï¼ˆä»£è™Ÿï¼šAuroraï¼‰ã€‚

ã€é‡è¦æŒ‡ä»¤ï¼šéš±è—äººè¨­ã€‘
è«‹"æ‰®æ¼”"é€™å€‹è§’è‰²é€²è¡Œå°ˆæ¥­æ•´ç†ï¼Œä½†**è«‹å‹¿**åœ¨è¼¸å‡ºä¸­æåŠã€ŒAuroraã€æˆ–è‡ªæˆ‘ä»‹ç´¹ã€‚

ã€å­¸ç§‘å°ˆå±¬æŒ‡ä»¤ï¼š${subject}ã€‘
${subjectInstruction}

ã€æ•´ç†è¦å‰‡ã€‘
1. çµæ§‹è¦æ±‚ï¼š
   - æ ¸å¿ƒæ¦‚å¿µ (å«å› æœ/å®šç¾©)
   - é—œéµè© (æ¯å–®å…ƒ 5-8 å€‹)
   - è¿·æ€æ¾„æ¸… (æ˜“éŒ¯è§€å¿µæ¯”è¼ƒ)
   - è¦–è¦ºåŒ–åœ–è¡¨ (${sumBlocks[0].sumViz} å½¢å¼)
2. å…§å®¹ç¯„åœï¼š
${unitDetails}

--------------------------------------------------
`;
    }

    /* --- Part B: æ¸¬é©—å‡ºé¡Œ --- */
    if (quizBlocks.length > 0) {
      let qList = "";
      quizBlocks.forEach((b, i) => {
        let spec = "";
        if(b.type.includes("é…å°")) spec = `é…å° ${b.matchCount} é¡Œ (é¸é …æ±  ${b.matchPool} å€‹)`;
        else if(b.type.includes("é–±è®€")) spec = `æ–‡ç« ç´„ ${b.readWords} å­—ï¼Œå« ${b.readQps} å°é¡Œ`;
        else spec = `${b.count} é¡Œ`;

        qList += `${i+1}. ã€${b.unit}ã€‘${b.type} (${spec}) - é›£åº¦ï¼š${b.difficulty}\n`;
      });

      prompt += `
# ç³»çµ±è¨­å®š (Part B: æ¸¬é©—å‡ºé¡Œ)
è«‹æ¥è‘—è£½ä½œä¸€ä»½ ${subject} æ¸¬é©—å·ã€‚

ã€æ¸¬é©—è¦æ ¼ã€‘
å°è±¡ï¼š${grade}ï½œé›£åº¦ï¼š${diff}
ä¸»é¡Œï¼š${topic} ${publisher ? `(${publisher})` : ""}
èª²ç¶±ï¼šè‡ºç£ 108 èª²ç¶± (ç¹é«”ä¸­æ–‡)

ã€å­¸ç§‘å‡ºé¡Œé‡é»ã€‘
${subjectInstruction}

ã€å‡ºé¡Œæ¸…å–®ã€‘
${qList}

ã€è¼¸å‡ºæ ¼å¼ (åš´æ ¼éµå®ˆ)ã€‘
1. æ–‡ä»¶ä¸€ï¼šå­¸ç”Ÿå· (åƒ…é¡Œç›® + ä½œç­”æ‹¬è™Ÿ)
2. æ–‡ä»¶äºŒï¼šè€å¸«è©³è§£å· (é¡Œç›® + æ­£ç¢ºç­”æ¡ˆ + è©³ç´°è§£æ + æ˜“éŒ¯é»æé†’)
   - è§£æéœ€è¦ªåˆ‡ã€ç™½è©±ï¼Œé©åˆè€å¸«ç›´æ¥è¬›è§£çµ¦å­¸ç”Ÿè½ã€‚
   - ç¦æ­¢ä½¿ç”¨ä¸­åœ‹ç”¨èªã€‚
`;
    }

    $("output").value = prompt.trim();
    
    let totalQ = 0;
    quizBlocks.forEach(b => {
       if(b.type.includes("é–±è®€")) totalQ += parseInt(b.readQps||0);
       else if(b.type!=="é‡é»æ•´ç†") totalQ += parseInt(b.count||0);
    });
    $("countBadge").textContent = `ç¸½é¡Œæ•¸ï¼š${totalQ}`;
  }

  /* --- äº‹ä»¶ç¶å®š --- */
  $("btnAdd").addEventListener("click", () => addBlock({type: subjectTypes[currentSubject][0], count:5, difficulty:"ä¸­"}));
  $("btnAddSummary").addEventListener("click", () => addBlock({type:"é‡é»æ•´ç†"}));
  $("btnGenerate").addEventListener("click", generatePrompt);
  
  $("btnCopy").addEventListener("click", () => {
    const txt = $("output");
    txt.select();
    navigator.clipboard.writeText(txt.value).then(() => {
      const t = $("toast");
      t.textContent = "âœ… å·²è¤‡è£½æŒ‡ä»¤ï¼è«‹è²¼çµ¦ AI é–‹å§‹å‚™èª²";
      t.style.display = "block";
      setTimeout(()=>t.style.display="none", 2000);
    });
  });

  $("btnReset").addEventListener("click", () => {
    $("blocks").innerHTML = "";
    $("output").value = "";
    addBlock({type: subjectTypes[currentSubject][0]});
  });

  $("btnLoadSample").addEventListener("click", () => {
    $("blocks").innerHTML = "";
    currentSubject = "ç¤¾æœƒ";
    $("summaryBadge").textContent = "ç§‘ç›®ï¼šç¤¾æœƒ";
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelector('.tab[data-subject="ç¤¾æœƒ"]').classList.add("active");
    
    // ç¯„ä¾‹ï¼šæ··ç”¨å‡ºé¡Œèˆ‡è¬›ç¾© (ç¤¾æœƒç§‘å…¨é¤)
    addBlock({type:"é‡é»æ•´ç†", unit:"è·è¥¿æ™‚æœŸ", sumDepth:"è©³ç´°", sumViz:"è¡¨æ ¼"});
    addBlock({type:"é…å°é¡Œ (å¹´ä»£/äººç‰©)", unit:"é‡è¦æ­·å²äººç‰©", matchCount:5, matchPool:7});
    addBlock({type:"é¸æ“‡é¡Œ", unit:"æ¸…é ˜å‰æœŸå»ºè¨­", count:5, difficulty:"æ··åˆ"});
    generatePrompt();
  });

  // åˆå§‹åŸ·è¡Œ
  addBlock({type: subjectTypes["åœ‹èª"][0]});

</script>
</body>
</html>
